<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::body},'index')}">

<body class="bg-dark" onload="getUnits('volume')">

<div class="jumbotron text-center bg-light text-dark">
  <div class="container">
    <i class="fas fa-vial fa-10x text-dark"></i>
    <h1>Unit Conversion Web Service</h1>
    <p>This is a web service built with Spring Boot and deployed to Heroku.</p>
  </div>
</div>
<div class="container text-light">
  <div class="alert alert-light text-center" role="alert">
    To deploy your own copy, and learn the fundamentals of Spring Boot and Heroku, head over to the
    <a href="https://github.com/jrshutske/unit-conversion-api" class="alert-link">
    unit-conversion-api</a> repository.
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3>How to use this api</h3>
      <ul>
        <li>Enter the measurement in question and this api will return the conversion into every other unit type, metric and imperial.</li>
        <li>Where possible it will adjust for your location.</li>
        <li>Measurements supported:</li>
        <li>Volume - gallons, quarts, cups, fluid ounces, liters, milliliters</li>
        <li>Length - miles, kilometers, yards, meters, feet, inches, centimeters, millimeters</li>
        <li>Weight - tons, metric tons, stone, pounds, kilograms, grams, ounces</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h3 style="text-align: center">Convert Units!</h3>
      <br>
      <form id="form">
        <div class="form-group">
          <label for="sel_type">Unit Type: </label>
          <select id="sel_type" class="form-control" onchange="getUnits(this.value)"></select>
        </div>
        <div id="div_unit_1" class="form-group">
          <label for="txt_unit_val_1">Convert: </label>
          <input id="txt_unit_val_1" class="form-control mb-2" type="text" />
          <select id="sel_unit_1" class="form-control"></select>
        </div>
        <div id="div_unit_2" class="form-group">
          <label for="sel_unit_2">To: </label>
          <select id="sel_unit_2" class="form-control"></select>
        </div>
        <div class="row justify-content-center">
          <input id="btn_submit" class="btn btn-primary mb-4" type="button" value="Convert" onclick="gen_output();" />
        </div>
        <div id="output">
        </div>
      </form>
    </div>
  </div>
  <div class="alert alert-light text-center" role="alert">
    <span>Try out the api here: </span>
    <a href="https://java-unit-conversion.herokuapp.com/api/length/kilometer/1337" class="alert-link">
       https://java-unit-conversion.herokuapp.com/api/length/kilometer/1337</a>
  </div>
</div>

<script>

    var dropdown_type = document.getElementById("sel_type");
    var dropdown_unit_1 = document.getElementById("sel_unit_1");
    var dropdown_unit_2 = document.getElementById("sel_unit_2");
    var txt_unit_1 = document.getElementById("txt_unit_val_1");
    var btn_submit = document.getElementById("btn_submit");
    var output = document.getElementById("output");

    var url = "https://java-unit-conversion.herokuapp.com/api";

    getUnitType();
    dropdown_type.focus();
    //getUnits();

    function getUnitType() {

      var xhr = new XMLHttpRequest();
      //let url = 'localhost:5000/api';

      xhr.open("get", url, true);
      xhr.withCredentials = true;


      if (xhr) {
        xhr.onreadystatechange = function() {

          if (xhr.readyState === 4) {

            var obj = JSON.parse(xhr.responseText);

            for (var unit in obj) {
              var option = document.createElement("option");
              option.text = obj[unit];
              //console.log("api returns: " + unit);
              option.value = obj[unit];
              dropdown_type.appendChild(option);
            }
          }
        };

        xhr.send();
      }
    }

    function getUnits(type) {

      var xhr = new XMLHttpRequest();

      var url2 = url + '/' + type;

      if (dropdown_type.value === undefined)
      {
        url2 = url + "/volume";
      }

      //let url = 'localhost:5000/api';

      xhr.open("get", url2, true);
      xhr.withCredentials = true;

      dropdown_unit_1.innerHTML = "";
      dropdown_unit_2.innerHTML = "";

      if (xhr) {
        xhr.onreadystatechange = function() {

          if (xhr.readyState === 4) {

            var obj = JSON.parse(xhr.responseText);

            for (var unit in obj)
            {
              var option = document.createElement("option");
              option.text = obj[unit];
              option.value = obj[unit];
              dropdown_unit_2.appendChild(option);
              dropdown_unit_1.innerHTML = dropdown_unit_2.innerHTML;
            }
          }
        };

        xhr.send();
      }
    }

    function gen_output() {

      var xhr = new XMLHttpRequest();
      var url2 = url + '/' + dropdown_type.value + '/' + dropdown_unit_1.value + '/' + parseFloat(txt_unit_1.value);
      //let url = 'localhost:5000/api';

      var out_text = document.createElement("span");

      xhr.open("get", url2, true);
      xhr.withCredentials = true;

      if (xhr) {
        xhr.onreadystatechange = function() {

          if (xhr.readyState === 4) {

            var obj = JSON.parse(xhr.responseText);

            for (var key in obj)
            {
              if (key === dropdown_unit_2.value)
              {
                var unitText = dropdown_unit_2.value.replace(dropdown_unit_2.value.charAt(0), dropdown_unit_2.value.charAt(0).toUpperCase());

                if (parseFloat(obj[key]) > 1)
                {
                  switch (dropdown_unit_2.value) {
                    case "foot":
                      unitText = "Feet";
                      break;
                    case "inch":
                      unitText += "es";
                      break;
                    case "celsius":
                      unitText += "";
                      break;
                    case "fahrenheit":
                      unitText += "";
                      break;
                    case "kelvin":
                      unitText += "";
                      break;
                    default:
                      unitText += "s";
                      break;
                  }
                }

                var val = parseFloat(obj[key]).toFixed(4);

                out_text.innerText = val + " " + unitText;
              }
            }

            var div = document.createElement("div");
            var h4 = document.createElement("h4");
            var unitText = dropdown_unit_1.value.replace(dropdown_unit_1.value.charAt(0), dropdown_unit_1.value.charAt(0).toUpperCase());

            if (parseFloat(txt_unit_1.value) > 1)
            {
              switch (dropdown_unit_1.value) {
                case "foot":
                  unitText = "Feet";
                  break;
                case "inch":
                  unitText += "es";
                  break;
                case "celsius":
                  unitText += "";
                  break;
                case "fahrenheit":
                  unitText += "";
                  break;
                case "kelvin":
                  unitText += "";
                  break;
                default:
                  unitText += "s";
                  break;
              }
            }

            h4.innerText = txt_unit_1.value + " " + unitText + " is equal to: " + out_text.innerText;
            h4.style = "text-align: center;";

            div.appendChild(h4);

            output.innerHTML = div.innerHTML;
          }
        };

        xhr.send();
      }
    }

</script>

</body>
</html>
